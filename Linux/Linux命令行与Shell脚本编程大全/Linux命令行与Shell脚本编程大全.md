[TOC]


## Linux终端和文件操作

### 命令行及命令参数

#### 命令行提示符

```bash
oscar@oscar-laptop:~$ 
# oscar 是当前用户的名字
# oscar-laptop 这是当前电脑/主机的名字
# ~ 表示当前用户的家目录，会随着用户进入不同目录而改变。
# $ 指示你所具有的权限的字符。在 Linux 系统中有两种可能：
# $表示普通用户，有权限的限制（比如不能修改重要的系统文件等）
# #表示超级用户，也就是 root
# 你好，你目前是以 oscar 这个用户登录；你的电脑名称为 oscar-laptop；你目前位于 ~ 目录下，就是你的用户家目录。你是普通用户，拥有有限的权限。
```

#### 命令和命令参数

##### 简单的命令

```bash
date
# Wed May 1 15:35:03 CEST 2019
```

##### 命令参数

```bash
command parameters
```

###### 短参数（一个字母）

```bash
# 最常用的参数形式就是一个短横线后接一个字母
command -p

# 如果我们要一次加好几个短参数，可以用空格隔开
command -p -a -T -c

# 多个短参数也可以合并在一起
command -paTc
```

###### 长参数（多个字母）

```
# 短参数是以一个短横线开始，而长参数是以两个短横线开始的
command --parameter

# 如果有多个长参数，是不能像多个短参数那样合并写的。而是只能以空格隔开
command --parameter1 --parameter2
```

###### 参数赋值

```
# 短参数赋值
# 表示把 10 赋值给 p 参数
command -p 10

# 如果是长参数，则一般是这样赋值
command --parameter=10
```

### 如何查找命令以及历史记录

#### 如何查找一个命令

#### 命令的记录

##### Ctrl + R ： 用于查找使用过的命令

##### history命令

用于列出之前使用过的所有命令

```bash
  825  2021-03-29 17:02:54 root chown ubuntu:ubuntu ubuntu
  828  2021-03-30 09:56:52 root cd /paasdata/offline/16.21.10B100_D02/
  829  2021-03-30 09:56:57 root cd oki-tools/tools/bin/
  830  2021-03-30 09:57:00 root ./oki-cli ume get
  835  2021-03-30 10:04:58 root cat /var/log/oki-ume.log | grep CMD | grep 'install'
  836  2021-03-30 10:05:16 root cat /var/log/oki-ume.log | grep CMD | grep 'ume install'
  837  2021-03-30 11:11:15 root clear
  838  2021-03-30 11:11:34 root ls
  839  2021-03-30 11:11:39 root pdm-cli --help
  842  2021-03-30 11:12:15 root pdm-cli label list --help
  845  2021-03-30 11:17:58 root clear
  846  2021-03-30 11:18:02 root history
```

### 文件组织

#### 文件的组织

##### 两种类型的文件

###### 普通的文件

这是我们已经熟知的文件类型，这样的文件包括：文本类型的文件（.txt、.doc、.odt等等），声音文件（.wav、.mp3、.ogg），还有程序等等

###### 特殊的文件

其它一些文件是特殊的，因为它们表示一些东西。例如，你的光盘驱动器就是这类特殊的文件。Windows 把电脑里的东西区分为文件和非文件，但 Linux 不是这样。对于 Linux 来说，**一切都是文件**！

#### pwd和which命令

##### pwd 命令：显示当前目录的路径

pwd 是英语 Print Working Directory 的缩写，表示“打印当前工作目录”。

##### which 命令：获取命令的可执行文件的位置

### 目录相关命令

#### ls命令：列出文件和目录

ls 是 list 的缩写，用于列出文件和目录。

##### 常用参数使用方法

| 参数 | 全称                                      | 含义                           |
| ---- | ----------------------------------------- | ------------------------------ |
| -a   |                                           | 显示所有文件和目录，包括隐藏的 |
| -l   |                                           | 详细列表                       |
| -h   | human-readable 的缩写，表示“适合人阅读的” | 以 K，M，G 的形式显示文件大小  |
| -t   | time 的缩写，表示“时间”                   | 按文件最近一次修改时间排序     |

#### cd 命令：切换目录

cd 是英语 change directory 的缩写，表示“切换目录”。

#### du 命令：显示目录包含的文件大小

du 是英语 disk usage 的缩写，表示“磁盘使用/占用”。

##### 常用参数使用方法

| 参数 | 全称                                        | 含义                          |
| ---- | ------------------------------------------- | ----------------------------- |
| -h   | human-readable 的首字母，表示“适合人阅读的” | 以 K，M，G 的形式显示文件大小 |
| -a   |                                             | 显示文件和目录的大小          |
| -s   | 英语 summarize 的首字母，表示“总结，概括”   | 只显示总计大小                |

### 文件的浏览和创建操作

#### 显示文件内容

##### cat 命令：一次性显示文件的所有内容

cat 命令的描述是“concatenate files and print on the standard output”，意思是“把文件连接起来，一并打印在标准输出”。

##### less 命令：分页显示文件内容

######  less 命令常用的快捷键

| 快捷键 | 含义                                                         |
| ------ | ------------------------------------------------------------ |
| 空格键 | 文件内容读取下一个终端屏幕的行数，相当于前进一个屏幕（页）<br/>与键盘上的 PageDown（下一页）效果一样 |
| 回车键 | 文件内容读取下一行，也就是前进一行，与键盘上的向下键效果是一样的 |
| d 键   | 前进半页（半个屏幕）                                         |
| b 键   | 后退一页，与键盘上的 PageUp（上一页）效果一样                |
| y 键   | 后退一行，与键盘上的向上键效果是一样的                       |
| u 键   | 后退半页（半个屏幕）                                         |
| q 键   | 停止读取文件，中止 less 命令                                 |

##### more命令和less命令的区别

more 命令和 less 命令的功能是类似的，而且 more 的缺陷就是它没有 less 那么强大，比如 more 命令虽然也是一页一页地显示文件，但是我们不能往后翻页，只能往前，“一路向北”。

#### 显示文件的开头和结尾

##### head 命令：显示文件开头

##### tail 命令：显示文件结尾

#### 创建文件和目录

##### touch 命令：创建一个空白文件

##### mkdir：创建一个目录

```bash
# 使用 -p 参数来递归地创建目录结构
mkdir -p one/two/three
```

### 文件的复制、移动、删除和链接操作

#### 拷贝文件和移动文件

##### cp 命令：拷贝文件或目录

cp 是英语 copy 的缩写，表示“拷贝”

```bash
cp new_file new_file_copy
```

###### 复制文件到另一个目录

```bash
cp new_file one/
```

###### 拷贝目录

在 cp 命令之后加上 -r 或者 -R 参数（大写和小写作用是一样的，都表示 recursive，也就是“递归的”）。拷贝的时候，目录中的所有内容（子目录和文件）都会被拷贝。

```bash
cp -r one one_copy
```

###### 使用通配符 *

```bash
cp *.txt folder
```

##### mv 命令：移动文件

mv 是英语 move 的缩写，表示“移动”

```bash
mv new_file_2 one
```

###### mv 命令有两个功能

```tex
1、移动文件（或目录）
2、重命名文件（或目录）
```

##### rm 命令：删除文件和目录

##### ln 命令：创建链接

###### 创建硬链接

```bash
ln file1 file2
#  以上命令创建了 file1 的一个硬链接 file2
```

###### 创建软链接

```bash
ln -s file1 file2
# 创建硬链接时 ln 命令不带任何参数，但是要创建软链接需要加上 -s 参数。s 是 symbolic（符号的）的缩写
```

###  用户管理：用户和权限

####  sudo 命令：以 root 身份运行命令

```tex
sudo 命令：暂时成为 root

sudo su 命令：一直成为 root
```

####  用户管理的命令

##### adduser 命令：添加新用户

##### passwd 命令：修改密码

##### deluser：删除用户

###  群组管理和文件权限管理

####  群组管理命令

##### addgroup：创建群组

##### usermod 命令：修改用户账户

##### delgroup 命令：删除群组

####  修改文件的所有者和群组

##### chown 命令：改变文件的所有者

chown 是 change 和 owner 的缩写，change 是英语“改变”的意思，owner 是英语“所有者”的意思。因此 chown 命令用于改变文件的所有者。

```bash
chown thomas file.txt
```

chown 命令也可以改变文件的群组

```bash
chown thomas:friends file.txt
```

##### chgrp 命令：改变文件的群组

```bash
chgrp thomas file.txt
```

#### chmod 命令：修改文件的访问权限

chmod 是 change 和 mode 的缩写，change 是英语“改变”的意思，mode 是“模式”的意思。chmod 命令用于修改文件的各种访问权限。

##### 用数字来分配权限：chmod 的绝对用法

| 权限 | 数字 |
| ---- | ---- |
| r    | 4    |
| w    | 2    |
| x    | 1    |

##### 用字母来分配权限：chmod 的相对用法

| 字母 | 全称                             | 含义         |
| ---- | -------------------------------- | ------------ |
| u    | user 的缩写，是英语“用户”的意思  | 表示所有者   |
| g    | group 的缩写，是英语“群组”的意思 | 表示群组用户 |
| o    | other 的缩写，是英语“其他”的意思 | 表示其他用户 |
| a    | all 的缩写，是英语“所有”的意思   | 表示所有用户 |

| 符号 | 含义               |
| ---- | ------------------ |
| +    | 加号，表示添加权限 |
| -    | 减号，表示去除权限 |
| =    | 等号，表示分配权限 |



```bash
#文件 file.txt 的所有者增加读和运行的权限。
chmod u+rx file.txt

#文件 file.txt 的群组其他用户增加读的权限。
chmod g+r file.txt 

#文件 file.txt 的其他用户移除读的权限。
chmod o-r file.txt 

#文件 file.txt 的群组其他用户增加读的权限，其他用户移除读的权限。
chmod g+r o-r file.txt 

#文件 file.txt 的群组其他用户和其他用户均移除读的权限。
chmod go-r file.txt 

#文件 file.txt 的所有用户增加运行的权限。
chmod +x file.txt 

#文件 file.txt 的所有者分配读，写和执行的权限；
#群组其他用户分配读的权限，不能写或执行；
#其他用户没有任何权限。
chmod u=rwx,g=r,o=- file.txt 
```

## Linux进程和数据流

### 数据处理

#### grep 命令：筛选数据

grep 是 Globally search a Regular Expression and Print 的缩写，意思是“全局搜索一个正则表达式，并且打印”。

```bash
grep text file
```

| 参数 | 含义                       |
| ---- | -------------------------- |
| -i   | 忽略大小写                 |
| -n   | 显示行号                   |
| -v   | 只显示文本不在的行         |
| -r   | 在所有子目录和子文件中查找 |

#### sort 命令：为文件排序

sort 是英语“排序”的意思。sort 命令用于对文件的行进行排序。

```bash
sort name.txt
```

| 参数 | 全称                                             | 含义                 |
| ---- | ------------------------------------------------ | -------------------- |
| -o   | o 是 output 的首字母，表示“输出”。               | 序后的内容写入新文件 |
| -r   | 是 reverse 的缩写，是“相反”的意思。              | 倒序排列             |
| -R   | R 是英语 random 的首字母，表示“随机的，任意的”。 | 随机排序             |
| -n   |                                                  | 对数字排序           |

#### wc 命令：文件的统计

wc 是 word count 的缩写（此处 wc 不是“厕所”的意思…），word 是“单词”的意思，count 是“计算，统计”的意思。

```bash
wc name.txt
# 9 9 50 name.txt
# 这三个数字，按顺序，分别表示：
# 行数（newline counts）：newline 是英语“换行、换行符”的意思，统计行数其实就是统计换行符的数目
# 单词数（word counts）
# 字节数（byte counts）：byte 是英语“字节”的意思，等于 8 个二进制位（bit）
```

| 参数 | 含义       |
| ---- | ---------- |
| -l   | 统计行数   |
| -w   | 统计单词数 |
| -c   | 统计字节数 |
| -m   | 统计字符数 |

#### uniq 命令：删除文件中的重复内容

```bash
uniq repeat.txt
```

| 参数 | 含义             |
| ---- | ---------------- |
| -c   | 统计重复的行数   |
| -d   | 只显示重复行的值 |

#### cut 命令：剪切文件的一部分内容

cut 命令用于对文件的每一行进行剪切处理。

| 参数 | 全称                                        | 含义                                                    |
| ---- | ------------------------------------------- | ------------------------------------------------------- |
| -c   |                                             | 根据字符数来剪切                                        |
| -d   | d 是 delimiter 的缩写，是英语“分隔符”的意思 | 用于指定用什么分隔符<br/>（比如逗号、分号、双引号等等） |
| -f   | f 是 field 的缩写，是英语“区域”的意思       | 表示剪切下用分隔符分隔的哪一块或哪几块区域              |

```bash
cut -d , -f 1 notes.csv

cut -d , -f 1,3 notes.csv
```

###  流和输出重定向

#### “> 和 >>”：重定向到文件

##### > ：重定向到新的文件

```bash
cut -d , -f 1 notes.csv > students.txt
```

Linux 中有一个俗称“黑洞”的文件，就是

```bash
/dev/null
```

/dev/null 文件是特殊文件，不是一个目录，此文件具有唯一的属性：它总是空的。它能使发送到 /dev/null 的任何数据作废，就好像这些数据掉进了无底的黑洞一般

##### >> : 重定向到文件末尾

```bash
cut -d , -f 1 notes.csv >> students.txt
```

#### “2>，2>>，2>&1”：重定向错误输出

##### stdin，stdout，stderr ：标准输入，标准输出，标准错误输出

| 文件描述符 | 名字   | 解释         |
| ---------- | ------ | ------------ |
| 0          | stdin  | 标准输入     |
| 1          | stdout | 标准输出     |
| 2          | stderr | 标准错误输出 |

```bash
cat not_exist_file.csv > results.txt 2> errors.log
# > results.txt ：将标准输出重定向到 results.txt 文件中
# 2> errors.log ：将标准错误输出重定向到 errors.log 文件中
```

##### 合并输出

使用 2>&1 这个组合符号

```bash
cat not_exist_file.csv > results.txt 2>&1
```

### 输入重定向和管道

#### <，<<：从文件或键盘读取

##### <：从文件中读取

```bash
cat < notes.csv
```

虽然 `cat < notes.csv` 的运行结果和 `cat notes.csv` 一样，但是原理却不一样:

```tex
1、cat notes.csv ：这种情况下，cat 命令接受的输入是 notes.csv 这个文件名，那么它要先打开 notes.csv 文件，然后打印出文件内容。
2、cat < notes.csv ：这种情况下，cat 命令接受的输入直接是 notes.csv 这个文件的内容，cat 命令只负责将其内容打印。而打开文件并将文件内容传递给 cat 命令的工作则交给 Shell 程序（也就是控制终端的程序）来完成。
```

##### <<：从键盘读取

<< 符号的作用是将键盘的输入重定向为某个命令的输入，很多情况下都很有用。

#### | ：管道

| 符号既然被称为“管道符号”，那么其作用就是“建立命令管道”

一个命令的输出可以作为另一个命令的输入，就好像将两根水管接起来一样，前一根水管流出来的水就会流入后一根水管了。

##### 实践

###### 按学生名字排序

```bash
cut -d , -f 1 notes.csv | sort  > sorted_names.txt
```

###### 根据大小排序目录

```bash
du | sort -nr | head
```

###### 列出包含关键字的文件

```bash
grep log -Ir /var/log | cut -d : -f 1 | sort | uniq
```

### 监视系统活动和查看进程
